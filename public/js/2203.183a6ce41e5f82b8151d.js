"use strict";(self.webpackChunkeco=self.webpackChunkeco||[]).push([[2203],{29527:(e,t,n)=>{n.d(t,{A:()=>c}),n(28706);var r=n(61941),a="district";const c={fetchDistricts:function(){return(0,r.A)().get(a).then((function(e){return e.data}))},fetchDistrictDetails:function(e){return(0,r.A)().get("".concat(a,"/").concat(e)).then((function(e){return e.data}))},fetchDistrictCalendarItems:function(e,t,n){return(0,r.A)().get("".concat(a,"/").concat(e,"/calendar-items"),{params:{startDate:t,endDate:n}}).then((function(e){return e.data}))},newDistrict:function(e){return(0,r.A)().post(a,e).then((function(e){return e.data}))},updateDistrict:function(e){return(0,r.A)().post("".concat(a,"/").concat(e.id),e)},deleteDistrict:function(e){return(0,r.A)().post("".concat(a,"/").concat(e.id,"/delete"))},detachDistrictCoach:function(e){var t=e.districtId,n=e.coachId;return(0,r.A)().post("".concat(a,"/").concat(t,"/coaches/").concat(n,"/detach"))},attachDistrictCoach:function(e){var t=e.districtId,n=e.coachId;return(0,r.A)().post("".concat(a,"/").concat(t,"/coaches/").concat(n,"/attach"))}}},42203:(e,t,n)=>{n.r(t),n.d(t,{default:()=>y});var r=n(5544),a=(n(62010),n(96540)),c=n(62493),o=n(55849),i=n(91858),u=n(47767),l=n(64467),s=(n(2008),n(50113),n(48980),n(51629),n(52675),n(62062),n(72712),n(67945),n(84185),n(83851),n(81278),n(79432),n(26099),n(58940),n(23500),n(9392)),f=n(95093),m=n.n(f),d=n(91736),p=n(89686),v=n(63750);function h(e){var t=e.coaches,n=e.onSelectCoach,c=e.onCancel,o=(0,a.useState)(null),i=(0,r.A)(o,2),u=i[0],l=i[1];return(0,a.useEffect)((function(){l(t[0].id)}),[]),a.createElement(v.A,{buttonConfirmText:"Plannen",closeModal:c,confirmAction:function(){n(u)},title:"Afspraak plannen"},"Er zijn meerdere coaches beschikbaar, selecteer een coach:",a.createElement("select",{className:"form-control input-sm",value:u,onChange:function(e){return l(e.target.value)}},t.map((function(e){return a.createElement("option",{key:e.id,value:e.id},e.fullName)}))))}function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach((function(t){(0,l.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e){var t=e.district,n=e.opportunityId,l=(0,u.Zp)(),f=(0,a.useState)(90),v=(0,r.A)(f,2),A=v[0],g=v[1],b=(0,a.useState)([]),y=(0,r.A)(b,2),k=y[0],N=y[1],w=(0,a.useState)([]),D=(0,r.A)(w,2),O=D[0],I=D[1],x=(0,a.useState)(m()().startOf("isoWeek").format("YYYY-MM-DD")),C=(0,r.A)(x,2),M=C[0],S=C[1],P=(0,a.useState)(""),j=(0,r.A)(P,2),Y=j[0],W=j[1],B=(0,a.useState)([]),R=(0,r.A)(B,2),q=R[0],z=R[1],L=(0,a.useState)(null),T=(0,r.A)(L,2),Z=T[0],G=T[1],Q=(0,a.useState)(!1),F=(0,r.A)(Q,2),H=F[0],J=F[1];(0,a.useEffect)((function(){t&&g(t.defaultDurationMinutes)}),[t]),(0,a.useEffect)((function(){t&&M&&(d.A.fetchDistrictAvailabilitiesByWeek({districtId:t.id,startOfWeek:M}).then((function(e){z(K(e))})),function(e){for(var t=[],n=0;n<7;n++)t.push(m()(e).add(n,"days"));N(t)}(M))}),[M,t]);var K=function(e){return e.reduce((function(e,t){return t.availabilities=t.availabilities.map((function(e){return E(E({},e),{},{from:m()(e.from),to:m()(e.to)})})),U(t).forEach((function(n){e.push(E(E({},n),{},{coach:{id:t.id,fullName:t.fullName}}))})),e}),[])},U=function(e){for(var t=e.quotationRequests.map((function(t){return{from:m()(t.datePlanned).subtract(e.coachMinMinutesBetweenAppointments,"minutes"),to:m()(t.datePlanned).add(t.durationMinutes,"minutes").add(e.coachMinMinutesBetweenAppointments,"minutes")}})),n=e.availabilities,r=function(){var e=t[a];n=n.reduce((function(t,n){return n.from.isSameOrAfter(e.from)&&n.to.isSameOrBefore(e.to)?t:n.from.isBefore(e.from)&&n.to.isAfter(e.to)?(t.push(E(E({},n),{},{from:n.from,to:e.from})),t.push(E(E({},n),{},{from:e.to,to:n.to})),t):n.from.isBefore(e.from)&&n.to.isSameOrAfter(e.from)?(t.push(E(E({},n),{},{from:n.from,to:e.from})),t):n.from.isSameOrBefore(e.to)&&n.to.isAfter(e.to)?(t.push(E(E({},n),{},{from:e.to,to:n.to})),t):(t.push(n),t)}),[])},a=0;a<t.length;a++)r();return n};(0,a.useEffect)((function(){V()}),[q,A]);var V=function(){var e=q.reduce((function(e,t){return!e||60*t.from.get("hour")+t.from.get("minute")<e?60*t.from.get("hour")+t.from.get("minute"):e}),null),t=q.reduce((function(e,t){return!e||60*t.to.get("hour")+t.to.get("minute")>e?60*t.to.get("hour")+t.to.get("minute"):e}),null);e&&t||I([]);for(var n=[],r=e=30*Math.floor(e/30);r<=t-A;r+=30)n.push(r);I(n)},X=function(e){var t=Math.floor(e/60),n=e%60;return(t=t<10?"0"+t:t)+":"+(n<10?"0"+n:n)},$=function(){for(var e=m()().startOf("isoWeek"),t=[],n=0;n<52;n++)t.push({value:e.format("YYYY-MM-DD"),text:"Week "+e.format("W")+" ("+e.format("DD-MM")+")"}),e.add(1,"w");return t},_=function(){var e=$().findIndex((function(e){return e.value===M}));if(e>0)return $()[e-1].value},ee=function(){var e=$().findIndex((function(e){return e.value===M}));if(e<$().length-1)return $()[e+1].value},te=function(e,t){return(Y?q.filter((function(e){return e.coach.id===parseInt(Y)})):q).filter((function(n){return n.from<=m()(e).add(t,"minutes")&&n.to>=m()(e).add(t+A,"minutes")}))},ne=function(e,r,a){if(!t)return null;H||(J(!0),p.A.newQuotationRequest({organisationOrCoachId:a,opportunityId:n,datePlanned:e.format("YYYY-MM-DD"),timePlanned:X(r),durationMinutes:A,usesPlanning:!0,districtId:t.id,statusId:8,opportunityActionCodeRef:"visit",projectManagerId:null,externalPartyId:null,dateRecorded:"",dateReleased:"",dateApprovedClient:"",dateApprovedProjectManager:"",dateApprovedExternal:""}).then((function(e){l("/offerteverzoek/".concat(e.data.id))})),G(null))};return a.createElement(c.A,null,a.createElement(s.A,null,a.createElement("div",{className:"row"},a.createElement("div",{className:"col-sm-3"},a.createElement(i.A,{disabled:!_(),iconName:"arrowLeft",buttonClassName:"btn-default btn-sm",onClickAction:function(){return S(_())}})),a.createElement("div",{className:"col-sm-2"},a.createElement("select",{className:"form-control input-sm",value:M,onChange:function(e){return S(e.target.value)}},$().map((function(e){return a.createElement("option",{key:e.value,value:e.value},e.text)})))),a.createElement("div",{className:"col-sm-2"},a.createElement("select",{className:"form-control input-sm",value:Y,onChange:function(e){return W(e.target.value)}},a.createElement("option",{value:""},"Alle coaches"),q.reduce((function(e,t){return e.find((function(e){return e.id===t.coach.id}))||e.push(t.coach),e}),[]).map((function(e){return{value:e.id,text:e.fullName}})).map((function(e){return a.createElement("option",{key:e.value,value:e.value},e.text)})))),a.createElement("div",{className:"col-sm-2"},a.createElement("select",{className:"form-control input-sm",value:A,onChange:function(e){return g(parseInt(e.target.value))}},function(){for(var e=[],t=30;t<=300;t+=30)e.push({value:t,text:t+" minuten"});return e}().map((function(e){return a.createElement("option",{key:e.value,value:e.value},e.text)})))),a.createElement("div",{className:"col-sm-3",style:{textAlign:"right"}},a.createElement(i.A,{disabled:!ee(),iconName:"arrowRight",buttonClassName:"btn-default btn-sm",onClickAction:function(){return S(ee())}})))),a.createElement(o.A,null,a.createElement("div",{className:"row"},a.createElement("div",{className:"col-md-12"},a.createElement("table",{className:"table-drag-select",style:{width:"100%"}},a.createElement("thead",null,a.createElement("tr",null,k.map((function(e,t){return a.createElement("th",{key:t,style:{textAlign:"center"}},e.format("dd DD-MM"))})))),a.createElement("tbody",null,0===O.length?a.createElement("tr",null,a.createElement("td",{colSpan:7,style:{textAlign:"center"}},"Geen beschikbare data gevonden")):O.map((function(e,t){return a.createElement("tr",{key:t},k.map((function(t,n){return te(t,e).length>0?a.createElement("td",{key:n,style:{textAlign:"center",padding:"3px"}},a.createElement("button",{className:"btn btn-sm",style:{width:"100%"},onClick:function(){return function(e,t){var n=te(e,t);1!==n.length?G({day:e,timeslot:t}):ne(e,t,n[0].coach.id)}(t,e)}},X(e)," -"," ",X(e+A))):a.createElement("td",{key:n,style:{textAlign:"center"}})})))}))))))),null!==Z&&a.createElement(h,{coaches:te(Z.day,Z.timeslot).map((function(e){return e.coach})),onSelectCoach:function(e){return ne(Z.day,Z.timeslot,e)},onCancel:function(){return G(null)}}))}var b=n(29527);function y(e){var t=(0,u.Zp)(),n=(0,u.g)(),l=(0,a.useState)(!1),s=(0,r.A)(l,2),f=s[0],m=s[1];return(0,a.useEffect)((function(){b.A.fetchDistrictDetails(n.districtId).then((function(e){m(e)}))}),[n.districtId]),a.createElement("div",{className:"row"},a.createElement("div",{className:"col-md-9"},a.createElement("div",{className:"col-md-12 margin-10-top"},a.createElement(c.A,null,a.createElement(o.A,{className:"panel-small"},a.createElement("div",{className:"row"},a.createElement("div",{className:"col-md-4"},a.createElement("div",{className:"btn-group",role:"group"},a.createElement(i.A,{iconName:"arrowLeft",onClickAction:function(){return t(-1)}}))),a.createElement("div",{className:"col-md-4"},a.createElement("h4",{className:"text-center"},"Afspraak plannen ",f.name)),a.createElement("div",{className:"col-md-4"}))))),a.createElement("div",{className:"col-md-12 margin-10-top"},a.createElement(g,{district:f,opportunityId:n.opportunityId}))),a.createElement("div",{className:"col-md-3"}))}},48980:(e,t,n)=>{var r=n(46518),a=n(59213).findIndex,c=n(6469),o="findIndex",i=!0;o in[]&&Array(1)[o]((function(){i=!1})),r({target:"Array",proto:!0,forced:i},{findIndex:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),c(o)},52703:(e,t,n)=>{var r=n(44576),a=n(79039),c=n(79504),o=n(655),i=n(43802).trim,u=n(47452),l=r.parseInt,s=r.Symbol,f=s&&s.iterator,m=/^[+-]?0x/i,d=c(m.exec),p=8!==l(u+"08")||22!==l(u+"0x16")||f&&!a((function(){l(Object(f))}));e.exports=p?function(e,t){var n=i(o(e));return l(n,t>>>0||(d(m,n)?16:10))}:l},58940:(e,t,n)=>{var r=n(46518),a=n(52703);r({global:!0,forced:parseInt!==a},{parseInt:a})},72712:(e,t,n)=>{var r=n(46518),a=n(80926).left,c=n(34598),o=n(39519);r({target:"Array",proto:!0,forced:!n(16193)&&o>79&&o<83||!c("reduce")},{reduce:function(e){var t=arguments.length;return a(this,e,t,t>1?arguments[1]:void 0)}})},80926:(e,t,n)=>{var r=n(79306),a=n(48981),c=n(47055),o=n(26198),i=TypeError,u="Reduce of empty array with no initial value",l=function(e){return function(t,n,l,s){var f=a(t),m=c(f),d=o(f);if(r(n),0===d&&l<2)throw new i(u);var p=e?d-1:0,v=e?-1:1;if(l<2)for(;;){if(p in m){s=m[p],p+=v;break}if(p+=v,e?p<0:d<=p)throw new i(u)}for(;e?p>=0:d>p;p+=v)p in m&&(s=n(s,m[p],p,f));return s}};e.exports={left:l(!1),right:l(!0)}},91736:(e,t,n)=>{n.d(t,{A:()=>o}),n(28706);var r=n(61941),a=n(61643),c="".concat((0,a.e)(),"/api/contact");const o={fetchContactAvailabilitiesByWeek:function(e,t){return(0,r.A)().get("".concat(c,"/").concat(e,"/availability/by-week"),{params:{startOfWeek:t}}).then((function(e){return e.data}))},updateContactAvailabilities:function(e,t){return(0,r.A)().post("".concat(c,"/").concat(e,"/availability"),t)},copyAvailabilities:function(e,t){return(0,r.A)().post("".concat(c,"/").concat(e,"/availability/copy-weeks"),t)},fetchDistrictAvailabilitiesByWeek:function(e){var t=e.districtId,n=e.startOfWeek;return(0,r.A)().get("".concat((0,a.e)(),"/api/district/").concat(t,"/availability/by-week"),{params:{startOfWeek:n}}).then((function(e){return e.data}))}}}}]);