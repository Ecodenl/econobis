"use strict";(self.webpackChunkeco=self.webpackChunkeco||[]).push([[2203],{91736:(e,t,n)=>{n.d(t,{A:()=>c});var a=n(61941),r="".concat(URL_API,"/api/contact");const c={fetchContactAvailabilitiesByWeek:function(e,t){return a.A.get("".concat(r,"/").concat(e,"/availability/by-week"),{params:{startOfWeek:t}}).then((function(e){return e.data}))},updateContactAvailabilities:function(e,t){return a.A.post("".concat(r,"/").concat(e,"/availability"),t)},copyAvailabilities:function(e,t){return a.A.post("".concat(r,"/").concat(e,"/availability/copy-weeks"),t)},fetchDistrictAvailabilitiesByWeek:function(e){var t=e.districtId,n=e.startOfWeek;return a.A.get("".concat(URL_API,"/api/district/").concat(t,"/availability/by-week"),{params:{startOfWeek:n}}).then((function(e){return e.data}))}}},29527:(e,t,n)=>{n.d(t,{A:()=>c});var a=n(61941),r="district";const c={fetchDistricts:function(){return a.A.get(r).then((function(e){return e.data}))},fetchDistrictDetails:function(e){return a.A.get("".concat(r,"/").concat(e)).then((function(e){return e.data}))},fetchDistrictCalendarItems:function(e,t,n){return a.A.get("".concat(r,"/").concat(e,"/calendar-items"),{params:{startDate:t,endDate:n}}).then((function(e){return e.data}))},newDistrict:function(e){return a.A.post(r,e).then((function(e){return e.data}))},updateDistrict:function(e){return a.A.post("".concat(r,"/").concat(e.id),e)},deleteDistrict:function(e){return a.A.post("".concat(r,"/").concat(e.id,"/delete"))},detachDistrictCoach:function(e){var t=e.districtId,n=e.coachId;return a.A.post("".concat(r,"/").concat(t,"/coaches/").concat(n,"/detach"))},attachDistrictCoach:function(e){var t=e.districtId,n=e.coachId;return a.A.post("".concat(r,"/").concat(t,"/coaches/").concat(n,"/attach"))}}},42203:(e,t,n)=>{n.r(t),n.d(t,{default:()=>y});var a=n(5544),r=n(96540),c=n(62493),o=n(55849),i=n(91858),u=n(24179),l=n(64467),s=n(9392),f=n(95093),m=n.n(f),d=n(91736),p=n(89686),v=n(63750);function h(e){var t=e.coaches,n=e.onSelectCoach,c=e.onCancel,o=(0,r.useState)(null),i=(0,a.A)(o,2),u=i[0],l=i[1];return(0,r.useEffect)((function(){l(t[0].id)}),[]),r.createElement(v.A,{buttonConfirmText:"Plannen",closeModal:c,confirmAction:function(){n(u)},title:"Afspraak plannen"},"Er zijn meerdere coaches beschikbaar, selecteer een coach:",r.createElement("select",{className:"form-control input-sm",value:u,onChange:function(e){return l(e.target.value)}},t.map((function(e){return r.createElement("option",{key:e.id,value:e.id},e.fullName)}))))}function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach((function(t){(0,l.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e){var t=e.district,n=e.opportunityId;if(!t)return null;var l=(0,r.useState)(90),f=(0,a.A)(l,2),v=f[0],A=f[1],g=(0,r.useState)([]),b=(0,a.A)(g,2),y=b[0],k=b[1],N=(0,r.useState)([]),D=(0,a.A)(N,2),O=D[0],w=D[1],C=(0,r.useState)(""),I=(0,a.A)(C,2),M=I[0],S=I[1],x=(0,r.useState)(""),P=(0,a.A)(x,2),j=P[0],W=P[1],Y=(0,r.useState)([]),B=(0,a.A)(Y,2),R=B[0],L=B[1],q=(0,r.useState)(null),z=(0,a.A)(q,2),U=z[0],_=z[1],G=(0,r.useState)(!1),Q=(0,a.A)(G,2),T=Q[0],F=Q[1];(0,r.useEffect)((function(){S(m()().startOf("isoWeek").format("YYYY-MM-DD")),A(t.defaultDurationMinutes)}),[]),(0,r.useEffect)((function(){M&&(d.A.fetchDistrictAvailabilitiesByWeek({districtId:t.id,startOfWeek:M}).then((function(e){L(H(e))})),V())}),[M]);var H=function(e){return e.reduce((function(e,t){return t.availabilities=t.availabilities.map((function(e){return E(E({},e),{},{from:m()(e.from),to:m()(e.to)})})),J(t).forEach((function(n){e.push(E(E({},n),{},{coach:{id:t.id,fullName:t.fullName}}))})),e}),[])},J=function(e){for(var t=e.quotationRequests.map((function(t){return{from:m()(t.datePlanned).subtract(e.coachMinMinutesBetweenAppointments,"minutes"),to:m()(t.datePlanned).add(t.durationMinutes,"minutes").add(e.coachMinMinutesBetweenAppointments,"minutes")}})),n=e.availabilities,a=function(){var e=t[r];n=n.reduce((function(t,n){return n.from.isSameOrAfter(e.from)&&n.to.isSameOrBefore(e.to)?t:n.from.isBefore(e.from)&&n.to.isAfter(e.to)?(t.push(E(E({},n),{},{from:n.from,to:e.from})),t.push(E(E({},n),{},{from:e.to,to:n.to})),t):n.from.isBefore(e.from)&&n.to.isSameOrAfter(e.from)?(t.push(E(E({},n),{},{from:n.from,to:e.from})),t):n.from.isSameOrBefore(e.to)&&n.to.isAfter(e.to)?(t.push(E(E({},n),{},{from:e.to,to:n.to})),t):(t.push(n),t)}),[])},r=0;r<t.length;r++)a();return n};(0,r.useEffect)((function(){K()}),[R,v]);var K=function(){var e=R.reduce((function(e,t){return!e||60*t.from.get("hour")+t.from.get("minute")<e?60*t.from.get("hour")+t.from.get("minute"):e}),null),t=R.reduce((function(e,t){return!e||60*t.to.get("hour")+t.to.get("minute")>e?60*t.to.get("hour")+t.to.get("minute"):e}),null);e&&t||w([]);for(var n=[],a=e=30*Math.floor(e/30);a<=t-v;a+=30)n.push(a);w(n)},V=function(){for(var e=[],t=m()(M),n=t.clone().endOf("isoWeek");t<=n;)e.push(t.clone()),t.add(1,"d");k(e)},X=function(e){var t=Math.floor(e/60),n=e%60;return(t=t<10?"0"+t:t)+":"+(n<10?"0"+n:n)},Z=function(){for(var e=m()().startOf("isoWeek"),t=[],n=0;n<52;n++)t.push({value:e.format("YYYY-MM-DD"),text:"Week "+e.format("W")+" ("+e.format("DD-MM")+")"}),e.add(1,"w");return t},$=function(){var e=Z().findIndex((function(e){return e.value===M}));if(e>0)return Z()[e-1].value},ee=function(){var e=Z().findIndex((function(e){return e.value===M}));if(e<Z().length-1)return Z()[e+1].value},te=function(e,t){return(j?R.filter((function(e){return e.coach.id===parseInt(j)})):R).filter((function(n){return n.from<=m()(e).add(t,"minutes")&&n.to>=m()(e).add(t+v,"minutes")}))},ne=function(e,a,r){T||(F(!0),p.A.newQuotationRequest({organisationOrCoachId:r,opportunityId:n,datePlanned:e.format("YYYY-MM-DD"),timePlanned:X(a),durationMinutes:v,usesPlanning:!0,districtId:t.id,statusId:8,opportunityActionCodeRef:"visit",projectManagerId:null,externalPartyId:null,dateRecorded:"",dateReleased:"",dateApprovedClient:"",dateApprovedProjectManager:"",dateApprovedExternal:""}).then((function(e){u.RL.push("/offerteverzoek/".concat(e.data.id))})),_(null))};return r.createElement(c.A,null,r.createElement(s.A,null,r.createElement("div",{className:"row"},r.createElement("div",{className:"col-sm-3"},r.createElement(i.A,{disabled:!$(),iconName:"arrowLeft",buttonClassName:"btn-default btn-sm",onClickAction:function(){return S($())}})),r.createElement("div",{className:"col-sm-2"},r.createElement("select",{className:"form-control input-sm",value:M,onChange:function(e){return S(e.target.value)}},Z().map((function(e){return r.createElement("option",{key:e.value,value:e.value},e.text)})))),r.createElement("div",{className:"col-sm-2"},r.createElement("select",{className:"form-control input-sm",value:j,onChange:function(e){return W(e.target.value)}},r.createElement("option",{value:""},"Alle coaches"),R.reduce((function(e,t){return e.find((function(e){return e.id===t.coach.id}))||e.push(t.coach),e}),[]).map((function(e){return{value:e.id,text:e.fullName}})).map((function(e){return r.createElement("option",{key:e.value,value:e.value},e.text)})))),r.createElement("div",{className:"col-sm-2"},r.createElement("select",{className:"form-control input-sm",value:v,onChange:function(e){return A(parseInt(e.target.value))}},function(){for(var e=[],t=30;t<=180;t+=15)e.push({value:t,text:t+" minuten"});return e}().map((function(e){return r.createElement("option",{key:e.value,value:e.value},e.text)})))),r.createElement("div",{className:"col-sm-3",style:{textAlign:"right"}},r.createElement(i.A,{disabled:!ee(),iconName:"arrowRight",buttonClassName:"btn-default btn-sm",onClickAction:function(){return S(ee())}})))),r.createElement(o.A,null,r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-12"},r.createElement("table",{className:"table-drag-select",style:{width:"100%"}},r.createElement("thead",null,r.createElement("tr",null,y.map((function(e,t){return r.createElement("th",{key:t,style:{textAlign:"center"}},e.format("dd DD-MM"))})))),r.createElement("tbody",null,0===O.length?r.createElement("tr",null,r.createElement("td",{colSpan:7,style:{textAlign:"center"}},"Geen beschikbare data gevonden")):O.map((function(e,t){return r.createElement("tr",{key:t},y.map((function(t,n){return te(t,e).length>0?r.createElement("td",{key:n,style:{textAlign:"center",padding:"3px"}},r.createElement("button",{className:"btn btn-sm",style:{width:"100%"},onClick:function(){return function(e,t){var n=te(e,t);1!==n.length?_({day:e,timeslot:t}):ne(e,t,n[0].coach.id)}(t,e)}},X(e)," - ",X(e+v))):r.createElement("td",{key:n,style:{textAlign:"center"}})})))}))))))),null!==U&&r.createElement(h,{coaches:te(U.day,U.timeslot).map((function(e){return e.coach})),onSelectCoach:function(e){return ne(U.day,U.timeslot,e)},onCancel:function(){return _(null)}}))}var b=n(29527);function y(e){var t=(0,r.useState)(!1),n=(0,a.A)(t,2),l=n[0],s=n[1];return(0,r.useEffect)((function(){b.A.fetchDistrictDetails(e.params.districtId).then((function(e){s(e)}))}),[]),r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-9"},r.createElement("div",{className:"col-md-12 margin-10-top"},r.createElement(c.A,null,r.createElement(o.A,{className:"panel-small"},r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-4"},r.createElement("div",{className:"btn-group",role:"group"},r.createElement(i.A,{iconName:"arrowLeft",onClickAction:u.Nc.goBack}))),r.createElement("div",{className:"col-md-4"},r.createElement("h4",{className:"text-center"},"Afspraak plannen ",l.name)),r.createElement("div",{className:"col-md-4"}))))),r.createElement("div",{className:"col-md-12 margin-10-top"},r.createElement(g,{district:l,opportunityId:e.params.opportunityId}))),r.createElement("div",{className:"col-md-3"}))}}}]);