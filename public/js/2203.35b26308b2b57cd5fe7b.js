"use strict";(self.webpackChunkeco=self.webpackChunkeco||[]).push([[2203],{29527:(e,t,n)=>{n.d(t,{A:()=>c});var a=n(61941),r="district";const c={fetchDistricts:function(){return(0,a.A)().get(r).then((function(e){return e.data}))},fetchDistrictDetails:function(e){return(0,a.A)().get("".concat(r,"/").concat(e)).then((function(e){return e.data}))},fetchDistrictCalendarItems:function(e,t,n){return(0,a.A)().get("".concat(r,"/").concat(e,"/calendar-items"),{params:{startDate:t,endDate:n}}).then((function(e){return e.data}))},newDistrict:function(e){return(0,a.A)().post(r,e).then((function(e){return e.data}))},updateDistrict:function(e){return(0,a.A)().post("".concat(r,"/").concat(e.id),e)},deleteDistrict:function(e){return(0,a.A)().post("".concat(r,"/").concat(e.id,"/delete"))},detachDistrictCoach:function(e){var t=e.districtId,n=e.coachId;return(0,a.A)().post("".concat(r,"/").concat(t,"/coaches/").concat(n,"/detach"))},attachDistrictCoach:function(e){var t=e.districtId,n=e.coachId;return(0,a.A)().post("".concat(r,"/").concat(t,"/coaches/").concat(n,"/attach"))}}},42203:(e,t,n)=>{n.r(t),n.d(t,{default:()=>y});var a=n(5544),r=n(96540),c=n(62493),o=n(55849),i=n(91858),u=n(47767),l=n(64467),s=n(9392),f=n(95093),m=n.n(f),d=n(91736),p=n(89686),v=n(63750);function h(e){var t=e.coaches,n=e.onSelectCoach,c=e.onCancel,o=(0,r.useState)(null),i=(0,a.A)(o,2),u=i[0],l=i[1];return(0,r.useEffect)((function(){l(t[0].id)}),[]),r.createElement(v.A,{buttonConfirmText:"Plannen",closeModal:c,confirmAction:function(){n(u)},title:"Afspraak plannen"},"Er zijn meerdere coaches beschikbaar, selecteer een coach:",r.createElement("select",{className:"form-control input-sm",value:u,onChange:function(e){return l(e.target.value)}},t.map((function(e){return r.createElement("option",{key:e.id,value:e.id},e.fullName)}))))}function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach((function(t){(0,l.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e){var t=e.district,n=e.opportunityId,l=(0,u.Zp)();if(!t)return null;var f=(0,r.useState)(90),v=(0,a.A)(f,2),A=v[0],g=v[1],b=(0,r.useState)([]),y=(0,a.A)(b,2),k=y[0],N=y[1],D=(0,r.useState)([]),O=(0,a.A)(D,2),w=O[0],C=O[1],M=(0,r.useState)(""),I=(0,a.A)(M,2),S=I[0],x=I[1],P=(0,r.useState)(""),j=(0,a.A)(P,2),W=j[0],Y=j[1],B=(0,r.useState)([]),R=(0,a.A)(B,2),q=R[0],z=R[1],L=(0,r.useState)(null),Z=(0,a.A)(L,2),G=Z[0],Q=Z[1],T=(0,r.useState)(!1),F=(0,a.A)(T,2),H=F[0],J=F[1];(0,r.useEffect)((function(){x(m()().startOf("isoWeek").format("YYYY-MM-DD")),g(t.defaultDurationMinutes)}),[]),(0,r.useEffect)((function(){S&&(d.A.fetchDistrictAvailabilitiesByWeek({districtId:t.id,startOfWeek:S}).then((function(e){z(K(e))})),X())}),[S]);var K=function(e){return e.reduce((function(e,t){return t.availabilities=t.availabilities.map((function(e){return E(E({},e),{},{from:m()(e.from),to:m()(e.to)})})),U(t).forEach((function(n){e.push(E(E({},n),{},{coach:{id:t.id,fullName:t.fullName}}))})),e}),[])},U=function(e){for(var t=e.quotationRequests.map((function(t){return{from:m()(t.datePlanned).subtract(e.coachMinMinutesBetweenAppointments,"minutes"),to:m()(t.datePlanned).add(t.durationMinutes,"minutes").add(e.coachMinMinutesBetweenAppointments,"minutes")}})),n=e.availabilities,a=function(){var e=t[r];n=n.reduce((function(t,n){return n.from.isSameOrAfter(e.from)&&n.to.isSameOrBefore(e.to)?t:n.from.isBefore(e.from)&&n.to.isAfter(e.to)?(t.push(E(E({},n),{},{from:n.from,to:e.from})),t.push(E(E({},n),{},{from:e.to,to:n.to})),t):n.from.isBefore(e.from)&&n.to.isSameOrAfter(e.from)?(t.push(E(E({},n),{},{from:n.from,to:e.from})),t):n.from.isSameOrBefore(e.to)&&n.to.isAfter(e.to)?(t.push(E(E({},n),{},{from:e.to,to:n.to})),t):(t.push(n),t)}),[])},r=0;r<t.length;r++)a();return n};(0,r.useEffect)((function(){V()}),[q,A]);var V=function(){var e=q.reduce((function(e,t){return!e||60*t.from.get("hour")+t.from.get("minute")<e?60*t.from.get("hour")+t.from.get("minute"):e}),null),t=q.reduce((function(e,t){return!e||60*t.to.get("hour")+t.to.get("minute")>e?60*t.to.get("hour")+t.to.get("minute"):e}),null);e&&t||C([]);for(var n=[],a=e=30*Math.floor(e/30);a<=t-A;a+=30)n.push(a);C(n)},X=function(){for(var e=[],t=m()(S),n=t.clone().endOf("isoWeek");t<=n;)e.push(t.clone()),t.add(1,"d");N(e)},$=function(e){var t=Math.floor(e/60),n=e%60;return(t=t<10?"0"+t:t)+":"+(n<10?"0"+n:n)},_=function(){for(var e=m()().startOf("isoWeek"),t=[],n=0;n<52;n++)t.push({value:e.format("YYYY-MM-DD"),text:"Week "+e.format("W")+" ("+e.format("DD-MM")+")"}),e.add(1,"w");return t},ee=function(){var e=_().findIndex((function(e){return e.value===S}));if(e>0)return _()[e-1].value},te=function(){var e=_().findIndex((function(e){return e.value===S}));if(e<_().length-1)return _()[e+1].value},ne=function(e,t){return(W?q.filter((function(e){return e.coach.id===parseInt(W)})):q).filter((function(n){return n.from<=m()(e).add(t,"minutes")&&n.to>=m()(e).add(t+A,"minutes")}))},ae=function(e,a,r){H||(J(!0),p.A.newQuotationRequest({organisationOrCoachId:r,opportunityId:n,datePlanned:e.format("YYYY-MM-DD"),timePlanned:$(a),durationMinutes:A,usesPlanning:!0,districtId:t.id,statusId:8,opportunityActionCodeRef:"visit",projectManagerId:null,externalPartyId:null,dateRecorded:"",dateReleased:"",dateApprovedClient:"",dateApprovedProjectManager:"",dateApprovedExternal:""}).then((function(e){l("/offerteverzoek/".concat(e.data.id))})),Q(null))};return r.createElement(c.A,null,r.createElement(s.A,null,r.createElement("div",{className:"row"},r.createElement("div",{className:"col-sm-3"},r.createElement(i.A,{disabled:!ee(),iconName:"arrowLeft",buttonClassName:"btn-default btn-sm",onClickAction:function(){return x(ee())}})),r.createElement("div",{className:"col-sm-2"},r.createElement("select",{className:"form-control input-sm",value:S,onChange:function(e){return x(e.target.value)}},_().map((function(e){return r.createElement("option",{key:e.value,value:e.value},e.text)})))),r.createElement("div",{className:"col-sm-2"},r.createElement("select",{className:"form-control input-sm",value:W,onChange:function(e){return Y(e.target.value)}},r.createElement("option",{value:""},"Alle coaches"),q.reduce((function(e,t){return e.find((function(e){return e.id===t.coach.id}))||e.push(t.coach),e}),[]).map((function(e){return{value:e.id,text:e.fullName}})).map((function(e){return r.createElement("option",{key:e.value,value:e.value},e.text)})))),r.createElement("div",{className:"col-sm-2"},r.createElement("select",{className:"form-control input-sm",value:A,onChange:function(e){return g(parseInt(e.target.value))}},function(){for(var e=[],t=30;t<=180;t+=15)e.push({value:t,text:t+" minuten"});return e}().map((function(e){return r.createElement("option",{key:e.value,value:e.value},e.text)})))),r.createElement("div",{className:"col-sm-3",style:{textAlign:"right"}},r.createElement(i.A,{disabled:!te(),iconName:"arrowRight",buttonClassName:"btn-default btn-sm",onClickAction:function(){return x(te())}})))),r.createElement(o.A,null,r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-12"},r.createElement("table",{className:"table-drag-select",style:{width:"100%"}},r.createElement("thead",null,r.createElement("tr",null,k.map((function(e,t){return r.createElement("th",{key:t,style:{textAlign:"center"}},e.format("dd DD-MM"))})))),r.createElement("tbody",null,0===w.length?r.createElement("tr",null,r.createElement("td",{colSpan:7,style:{textAlign:"center"}},"Geen beschikbare data gevonden")):w.map((function(e,t){return r.createElement("tr",{key:t},k.map((function(t,n){return ne(t,e).length>0?r.createElement("td",{key:n,style:{textAlign:"center",padding:"3px"}},r.createElement("button",{className:"btn btn-sm",style:{width:"100%"},onClick:function(){return function(e,t){var n=ne(e,t);1!==n.length?Q({day:e,timeslot:t}):ae(e,t,n[0].coach.id)}(t,e)}},$(e)," -"," ",$(e+A))):r.createElement("td",{key:n,style:{textAlign:"center"}})})))}))))))),null!==G&&r.createElement(h,{coaches:ne(G.day,G.timeslot).map((function(e){return e.coach})),onSelectCoach:function(e){return ae(G.day,G.timeslot,e)},onCancel:function(){return Q(null)}}))}var b=n(29527);function y(e){var t=(0,u.Zp)(),n=(0,u.g)(),l=(0,r.useState)(!1),s=(0,a.A)(l,2),f=s[0],m=s[1];return(0,r.useEffect)((function(){b.A.fetchDistrictDetails(n.districtId).then((function(e){m(e)}))}),[]),r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-9"},r.createElement("div",{className:"col-md-12 margin-10-top"},r.createElement(c.A,null,r.createElement(o.A,{className:"panel-small"},r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-4"},r.createElement("div",{className:"btn-group",role:"group"},r.createElement(i.A,{iconName:"arrowLeft",onClickAction:function(){return t(-1)}}))),r.createElement("div",{className:"col-md-4"},r.createElement("h4",{className:"text-center"},"Afspraak plannen ",f.name)),r.createElement("div",{className:"col-md-4"}))))),r.createElement("div",{className:"col-md-12 margin-10-top"},r.createElement(g,{district:f,opportunityId:n.opportunityId}))),r.createElement("div",{className:"col-md-3"}))}},91736:(e,t,n)=>{n.d(t,{A:()=>o});var a=n(61941),r=n(61643),c="".concat((0,r.e)(),"/api/contact");const o={fetchContactAvailabilitiesByWeek:function(e,t){return(0,a.A)().get("".concat(c,"/").concat(e,"/availability/by-week"),{params:{startOfWeek:t}}).then((function(e){return e.data}))},updateContactAvailabilities:function(e,t){return(0,a.A)().post("".concat(c,"/").concat(e,"/availability"),t)},copyAvailabilities:function(e,t){return(0,a.A)().post("".concat(c,"/").concat(e,"/availability/copy-weeks"),t)},fetchDistrictAvailabilitiesByWeek:function(e){var t=e.districtId,n=e.startOfWeek;return(0,a.A)().get("".concat((0,r.e)(),"/api/district/").concat(t,"/availability/by-week"),{params:{startOfWeek:n}}).then((function(e){return e.data}))}}}}]);