(window.webpackJsonp=window.webpackJsonp||[]).push([[84],{1094:function(t,e,n){"use strict";var a=n(2),r="".concat(URL_API,"/api/contact");e.a={fetchContactAvailabilitiesByWeek:function(t,e){return a.a.get("".concat(r,"/").concat(t,"/availability/by-week"),{params:{startOfWeek:e}}).then((function(t){return t.data}))},updateContactAvailabilities:function(t,e){return a.a.post("".concat(r,"/").concat(t,"/availability"),e)},copyAvailabilities:function(t,e){return a.a.post("".concat(r,"/").concat(t,"/availability/copy-weeks"),e)},fetchDistrictAvailabilitiesByWeek:function(t){var e=t.districtId,n=t.startOfWeek;return a.a.get("".concat(URL_API,"/api/district/").concat(e,"/availability/by-week"),{params:{startOfWeek:n}}).then((function(t){return t.data}))}}},1680:function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return w}));var a=n(547),r=n.n(a),c=n(0),o=n.n(c),i=n(27),u=n(30),l=n(50),s=n(4),f=n(5),m=n.n(f),d=n(53),p=n(7),h=n.n(p),v=n(1094),b=n(233),E=n(35);function g(t){var e=t.coaches,n=t.onSelectCoach,a=t.onCancel,i=Object(c.useState)(null),u=r()(i,2),l=u[0],s=u[1];Object(c.useEffect)((function(){s(e[0].id)}),[]);return o.a.createElement(E.a,{buttonConfirmText:"Plannen",closeModal:a,confirmAction:function(){n(l)},title:"Afspraak plannen"},"Er zijn meerdere coaches beschikbaar, selecteer een coach:",o.a.createElement("select",{className:"form-control input-sm",value:l,onChange:function(t){return s(t.target.value)}},e.map((function(t){return o.a.createElement("option",{key:t.id,value:t.id},t.fullName)}))))}function y(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function O(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?y(Object(n),!0).forEach((function(e){m()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function k(t){var e=t.districtId,n=t.opportunityId,a=Object(c.useState)([]),f=r()(a,2),m=f[0],p=f[1],E=Object(c.useState)([]),y=r()(E,2),k=y[0],N=y[1],w=Object(c.useState)(""),D=r()(w,2),A=D[0],j=D[1],I=Object(c.useState)(""),C=r()(I,2),M=C[0],P=C[1],x=Object(c.useState)([]),S=r()(x,2),W=S[0],Y=S[1],B=Object(c.useState)(null),R=r()(B,2),q=R[0],z=R[1];Object(c.useEffect)((function(){j(h()().startOf("isoWeek").format("YYYY-MM-DD"))}),[]),Object(c.useEffect)((function(){A&&(v.a.fetchDistrictAvailabilitiesByWeek({districtId:e,startOfWeek:A}).then((function(t){Y(J(t))})),_())}),[A]);var J=function(t){return t.reduce((function(t,e){return e.availabilities=e.availabilities.map((function(t){return O(O({},t),{},{from:h()(t.from),to:h()(t.to)})})),L(e).forEach((function(n){t.push(O(O({},n),{},{coach:{id:e.id,fullName:e.fullName}}))})),t}),[])},L=function(t){for(var e=t.quotationRequests.map((function(e){return{from:h()(e.datePlanned).subtract(t.coachMinMinutesBetweenAppointments,"minutes"),to:h()(e.datePlanned).add(e.durationMinutes,"minutes").add(t.coachMinMinutesBetweenAppointments,"minutes")}})),n=t.availabilities,a=function(t){var a=e[t];n=n.reduce((function(t,e){return e.from.isBefore(a.from)&&e.to.isAfter(a.to)?(t.push(O(O({},e),{},{from:e.from,to:a.from})),t.push(O(O({},e),{},{from:a.to,to:e.to})),t):e.from.isBefore(a.from)&&e.to.isAfter(a.from)?(t.push(O(O({},e),{},{from:e.from,to:a.from})),t):e.from.isBefore(a.to)&&e.to.isAfter(a.to)?(t.push(O(O({},e),{},{from:a.to,to:e.to})),t):(t.push(e),t)}),[])},r=0;r<e.length;r++)a(r);return n};Object(c.useEffect)((function(){U()}),[W]);var U=function(){var t=W.reduce((function(t,e){return!t||60*e.from.get("hour")+e.from.get("minute")<t?60*e.from.get("hour")+e.from.get("minute"):t}),null),e=W.reduce((function(t,e){return!t||60*e.to.get("hour")+e.to.get("minute")>t?60*e.to.get("hour")+e.to.get("minute"):t}),null);t&&e||N([]);for(var n=[],a=t=30*Math.floor(t/30);a<=e-90;a+=30)n.push(a);N(n)},_=function(){for(var t=[],e=h()(A),n=e.clone().endOf("isoWeek");e<=n;)t.push(e.clone()),e.add(1,"d");p(t)},G=function(t){var e=Math.floor(t/60),n=t%60;return(e=e<10?"0"+e:e)+":"+(n=n<10?"0"+n:n)},Q=function(){for(var t=h()().startOf("isoWeek"),e=[],n=0;n<52;n++)e.push({value:t.format("YYYY-MM-DD"),text:"Week "+t.format("W")+" ("+t.format("DD-MM")+")"}),t.add(1,"w");return e},T=function(){var t=Q().findIndex((function(t){return t.value===A}));if(t>0)return Q()[t-1].value},F=function(){var t=Q().findIndex((function(t){return t.value===A}));if(t<Q().length-1)return Q()[t+1].value},H=function(t,e){return(M?W.filter((function(t){return t.coach.id===parseInt(M)})):W).filter((function(n){return n.from<=h()(t).add(e,"minutes")&&n.to>=h()(t).add(e+90,"minutes")}))},K=function(t,a,r){b.a.newQuotationRequest({organisationOrCoachId:r,opportunityId:n,datePlanned:t.format("YYYY-MM-DD"),timePlanned:G(a),durationMinutes:90,usesPlanning:!0,districtId:e,statusId:8,opportunityActionCodeRef:"visit",projectManagerId:null,externalPartyId:null,dateRecorded:"",dateReleased:"",dateApprovedClient:"",dateApprovedProjectManager:"",dateApprovedExternal:""}).then((function(t){s.f.push("/offerteverzoek/".concat(t.data.id))})),z(null)};return o.a.createElement(i.a,null,o.a.createElement(d.a,null,o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col-sm-4"},o.a.createElement(l.a,{disabled:!T(),iconName:"glyphicon-arrow-left",buttonClassName:"btn-default btn-sm",onClickAction:function(){return j(T())}})),o.a.createElement("div",{className:"col-sm-2"},o.a.createElement("select",{className:"form-control input-sm",value:A,onChange:function(t){return j(t.target.value)}},Q().map((function(t){return o.a.createElement("option",{key:t.value,value:t.value},t.text)})))),o.a.createElement("div",{className:"col-sm-2"},o.a.createElement("select",{className:"form-control input-sm",value:M,onChange:function(t){return P(t.target.value)}},o.a.createElement("option",{value:""},"Alle coaches"),W.reduce((function(t,e){return t.find((function(t){return t.id===e.coach.id}))||t.push(e.coach),t}),[]).map((function(t){return{value:t.id,text:t.fullName}})).map((function(t){return o.a.createElement("option",{key:t.value,value:t.value},t.text)})))),o.a.createElement("div",{className:"col-sm-4",style:{textAlign:"right"}},o.a.createElement(l.a,{disabled:!F(),iconName:"glyphicon-arrow-right",buttonClassName:"btn-default btn-sm",onClickAction:function(){return j(F())}})))),o.a.createElement(u.a,null,o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col-md-12"},o.a.createElement("table",{className:"table-drag-select",style:{width:"100%"}},o.a.createElement("thead",null,o.a.createElement("tr",null,m.map((function(t,e){return o.a.createElement("th",{key:e,style:{textAlign:"center"}},t.format("dd DD-MM"))})))),o.a.createElement("tbody",null,0===k.length?o.a.createElement("tr",null,o.a.createElement("td",{colSpan:7,style:{textAlign:"center"}},"Geen beschikbare data gevonden")):k.map((function(t,e){return o.a.createElement("tr",{key:e},m.map((function(e,n){return H(e,t).length>0?o.a.createElement("td",{key:n,style:{textAlign:"center",padding:"3px"}},o.a.createElement("button",{className:"btn btn-sm",style:{width:"100%"},onClick:function(){return function(t,e){var n=H(t,e);1!==n.length?z({day:t,timeslot:e}):K(t,e,n[0].coach.id)}(e,t)}},G(t)," - ",G(t+90))):o.a.createElement("td",{key:n,style:{textAlign:"center"}})})))}))))))),null!==q&&o.a.createElement(g,{coaches:H(q.day,q.timeslot).map((function(t){return t.coach})),onSelectCoach:function(t){return K(q.day,q.timeslot,t)},onCancel:function(){return z(null)}}))}var N=n(954);function w(t){var e=Object(c.useState)(!1),n=r()(e,2),a=n[0],f=n[1];return Object(c.useEffect)((function(){N.a.fetchDistrictDetails(t.params.districtId).then((function(t){f(t)}))}),[]),o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col-md-9"},o.a.createElement("div",{className:"col-md-12 margin-10-top"},o.a.createElement(i.a,null,o.a.createElement(u.a,{className:"panel-small"},o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col-md-4"},o.a.createElement("div",{className:"btn-group",role:"group"},o.a.createElement(l.a,{iconName:"glyphicon-arrow-left",onClickAction:s.e.goBack}))),o.a.createElement("div",{className:"col-md-4"},o.a.createElement("h4",{className:"text-center"},"Afspraak plannen ",a.name)),o.a.createElement("div",{className:"col-md-4"}))))),o.a.createElement("div",{className:"col-md-12 margin-10-top"},o.a.createElement(k,{districtId:t.params.districtId,opportunityId:t.params.opportunityId}))),o.a.createElement("div",{className:"col-md-3"}))}},954:function(t,e,n){"use strict";var a=n(2);e.a={fetchDistricts:function(){return a.a.get("district").then((function(t){return t.data}))},fetchDistrictDetails:function(t){return a.a.get("".concat("district","/").concat(t)).then((function(t){return t.data}))},fetchDistrictCalendarItems:function(t,e,n){return a.a.get("".concat("district","/").concat(t,"/calendar-items"),{params:{startDate:e,endDate:n}}).then((function(t){return t.data}))},newDistrict:function(t){return a.a.post("district",t).then((function(t){return t.data}))},updateDistrict:function(t){return a.a.post("".concat("district","/").concat(t.id),t)},deleteDistrict:function(t){return a.a.post("".concat("district","/").concat(t.id,"/delete"))},detachDistrictCoach:function(t){var e=t.districtId,n=t.coachId;return a.a.post("".concat("district","/").concat(e,"/coaches/").concat(n,"/detach"))},attachDistrictCoach:function(t){var e=t.districtId,n=t.coachId;return a.a.post("".concat("district","/").concat(e,"/coaches/").concat(n,"/attach"))}}}}]);