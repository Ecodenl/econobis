"use strict";(self.webpackChunkeco=self.webpackChunkeco||[]).push([[8867],{14050:(e,t,n)=>{n.d(t,{Z:()=>c});var a=n(69265),r="".concat(URL_API,"/api/contact");const c={fetchContactAvailabilitiesByWeek:function(e,t){return a.Z.get("".concat(r,"/").concat(e,"/availability/by-week"),{params:{startOfWeek:t}}).then((function(e){return e.data}))},updateContactAvailabilities:function(e,t){return a.Z.post("".concat(r,"/").concat(e,"/availability"),t)},copyAvailabilities:function(e,t){return a.Z.post("".concat(r,"/").concat(e,"/availability/copy-weeks"),t)},fetchDistrictAvailabilitiesByWeek:function(e){var t=e.districtId,n=e.startOfWeek;return a.Z.get("".concat(URL_API,"/api/district/").concat(t,"/availability/by-week"),{params:{startOfWeek:n}}).then((function(e){return e.data}))}}},97809:(e,t,n)=>{n.d(t,{Z:()=>c});var a=n(69265),r="district";const c={fetchDistricts:function(){return a.Z.get(r).then((function(e){return e.data}))},fetchDistrictDetails:function(e){return a.Z.get("".concat(r,"/").concat(e)).then((function(e){return e.data}))},fetchDistrictCalendarItems:function(e,t,n){return a.Z.get("".concat(r,"/").concat(e,"/calendar-items"),{params:{startDate:t,endDate:n}}).then((function(e){return e.data}))},newDistrict:function(e){return a.Z.post(r,e).then((function(e){return e.data}))},updateDistrict:function(e){return a.Z.post("".concat(r,"/").concat(e.id),e)},deleteDistrict:function(e){return a.Z.post("".concat(r,"/").concat(e.id,"/delete"))},detachDistrictCoach:function(e){var t=e.districtId,n=e.coachId;return a.Z.post("".concat(r,"/").concat(t,"/coaches/").concat(n,"/detach"))},attachDistrictCoach:function(e){var t=e.districtId,n=e.coachId;return a.Z.post("".concat(r,"/").concat(t,"/coaches/").concat(n,"/attach"))}}},18867:(e,t,n)=>{n.r(t),n.d(t,{default:()=>k});var a=n(29439),r=n(67294),c=n(14309),o=n(98688),i=n(55451),l=n(61409),u=n(4942),s=n(80720),f=n(30381),m=n.n(f),d=n(14050),p=n(89038),h=n(41355);function v(e){var t=e.coaches,n=e.onSelectCoach,c=e.onCancel,o=(0,r.useState)(null),i=(0,a.Z)(o,2),l=i[0],u=i[1];return(0,r.useEffect)((function(){u(t[0].id)}),[]),r.createElement(h.Z,{buttonConfirmText:"Plannen",closeModal:c,confirmAction:function(){n(l)},title:"Afspraak plannen"},"Er zijn meerdere coaches beschikbaar, selecteer een coach:",r.createElement("select",{className:"form-control input-sm",value:l,onChange:function(e){return u(e.target.value)}},t.map((function(e){return r.createElement("option",{key:e.id,value:e.id},e.fullName)}))))}function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){(0,u.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function b(e){var t=e.districtId,n=e.opportunityId,u=(0,r.useState)([]),f=(0,a.Z)(u,2),h=f[0],E=f[1],b=(0,r.useState)([]),y=(0,a.Z)(b,2),k=y[0],Z=y[1],N=(0,r.useState)(""),A=(0,a.Z)(N,2),D=A[0],w=A[1],I=(0,r.useState)(""),O=(0,a.Z)(I,2),C=O[0],M=O[1],P=(0,r.useState)([]),x=(0,a.Z)(P,2),j=x[0],S=x[1],W=(0,r.useState)(null),Y=(0,a.Z)(W,2),B=Y[0],R=Y[1];(0,r.useEffect)((function(){w(m()().startOf("isoWeek").format("YYYY-MM-DD"))}),[]),(0,r.useEffect)((function(){D&&(d.Z.fetchDistrictAvailabilitiesByWeek({districtId:t,startOfWeek:D}).then((function(e){S(q(e))})),U())}),[D]);var q=function(e){return e.reduce((function(e,t){return t.availabilities=t.availabilities.map((function(e){return g(g({},e),{},{from:m()(e.from),to:m()(e.to)})})),z(t).forEach((function(n){e.push(g(g({},n),{},{coach:{id:t.id,fullName:t.fullName}}))})),e}),[])},z=function(e){for(var t=e.quotationRequests.map((function(t){return{from:m()(t.datePlanned).subtract(e.coachMinMinutesBetweenAppointments,"minutes"),to:m()(t.datePlanned).add(t.durationMinutes,"minutes").add(e.coachMinMinutesBetweenAppointments,"minutes")}})),n=e.availabilities,a=function(){var e=t[r];n=n.reduce((function(t,n){return n.from.isBefore(e.from)&&n.to.isAfter(e.to)?(t.push(g(g({},n),{},{from:n.from,to:e.from})),t.push(g(g({},n),{},{from:e.to,to:n.to})),t):n.from.isBefore(e.from)&&n.to.isAfter(e.from)?(t.push(g(g({},n),{},{from:n.from,to:e.from})),t):n.from.isBefore(e.to)&&n.to.isAfter(e.to)?(t.push(g(g({},n),{},{from:e.to,to:n.to})),t):(t.push(n),t)}),[])},r=0;r<t.length;r++)a();return n};(0,r.useEffect)((function(){L()}),[j]);var L=function(){var e=j.reduce((function(e,t){return!e||60*t.from.get("hour")+t.from.get("minute")<e?60*t.from.get("hour")+t.from.get("minute"):e}),null),t=j.reduce((function(e,t){return!e||60*t.to.get("hour")+t.to.get("minute")>e?60*t.to.get("hour")+t.to.get("minute"):e}),null);e&&t||Z([]);for(var n=[],a=e=30*Math.floor(e/30);a<=t-90;a+=30)n.push(a);Z(n)},U=function(){for(var e=[],t=m()(D),n=t.clone().endOf("isoWeek");t<=n;)e.push(t.clone()),t.add(1,"d");E(e)},_=function(e){var t=Math.floor(e/60),n=e%60;return(t=t<10?"0"+t:t)+":"+(n<10?"0"+n:n)},G=function(){for(var e=m()().startOf("isoWeek"),t=[],n=0;n<52;n++)t.push({value:e.format("YYYY-MM-DD"),text:"Week "+e.format("W")+" ("+e.format("DD-MM")+")"}),e.add(1,"w");return t},Q=function(){var e=G().findIndex((function(e){return e.value===D}));if(e>0)return G()[e-1].value},T=function(){var e=G().findIndex((function(e){return e.value===D}));if(e<G().length-1)return G()[e+1].value},F=function(e,t){return(C?j.filter((function(e){return e.coach.id===parseInt(C)})):j).filter((function(n){return n.from<=m()(e).add(t,"minutes")&&n.to>=m()(e).add(t+90,"minutes")}))},H=function(e,a,r){p.Z.newQuotationRequest({organisationOrCoachId:r,opportunityId:n,datePlanned:e.format("YYYY-MM-DD"),timePlanned:_(a),durationMinutes:90,usesPlanning:!0,districtId:t,statusId:8,opportunityActionCodeRef:"visit",projectManagerId:null,externalPartyId:null,dateRecorded:"",dateReleased:"",dateApprovedClient:"",dateApprovedProjectManager:"",dateApprovedExternal:""}).then((function(e){l.nA.push("/offerteverzoek/".concat(e.data.id))})),R(null)};return r.createElement(c.Z,null,r.createElement(s.Z,null,r.createElement("div",{className:"row"},r.createElement("div",{className:"col-sm-4"},r.createElement(i.Z,{disabled:!Q(),iconName:"glyphicon-arrow-left",buttonClassName:"btn-default btn-sm",onClickAction:function(){return w(Q())}})),r.createElement("div",{className:"col-sm-2"},r.createElement("select",{className:"form-control input-sm",value:D,onChange:function(e){return w(e.target.value)}},G().map((function(e){return r.createElement("option",{key:e.value,value:e.value},e.text)})))),r.createElement("div",{className:"col-sm-2"},r.createElement("select",{className:"form-control input-sm",value:C,onChange:function(e){return M(e.target.value)}},r.createElement("option",{value:""},"Alle coaches"),j.reduce((function(e,t){return e.find((function(e){return e.id===t.coach.id}))||e.push(t.coach),e}),[]).map((function(e){return{value:e.id,text:e.fullName}})).map((function(e){return r.createElement("option",{key:e.value,value:e.value},e.text)})))),r.createElement("div",{className:"col-sm-4",style:{textAlign:"right"}},r.createElement(i.Z,{disabled:!T(),iconName:"glyphicon-arrow-right",buttonClassName:"btn-default btn-sm",onClickAction:function(){return w(T())}})))),r.createElement(o.Z,null,r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-12"},r.createElement("table",{className:"table-drag-select",style:{width:"100%"}},r.createElement("thead",null,r.createElement("tr",null,h.map((function(e,t){return r.createElement("th",{key:t,style:{textAlign:"center"}},e.format("dd DD-MM"))})))),r.createElement("tbody",null,0===k.length?r.createElement("tr",null,r.createElement("td",{colSpan:7,style:{textAlign:"center"}},"Geen beschikbare data gevonden")):k.map((function(e,t){return r.createElement("tr",{key:t},h.map((function(t,n){return F(t,e).length>0?r.createElement("td",{key:n,style:{textAlign:"center",padding:"3px"}},r.createElement("button",{className:"btn btn-sm",style:{width:"100%"},onClick:function(){return function(e,t){var n=F(e,t);1!==n.length?R({day:e,timeslot:t}):H(e,t,n[0].coach.id)}(t,e)}},_(e)," - ",_(e+90))):r.createElement("td",{key:n,style:{textAlign:"center"}})})))}))))))),null!==B&&r.createElement(v,{coaches:F(B.day,B.timeslot).map((function(e){return e.coach})),onSelectCoach:function(e){return H(B.day,B.timeslot,e)},onCancel:function(){return R(null)}}))}var y=n(97809);function k(e){var t=(0,r.useState)(!1),n=(0,a.Z)(t,2),u=n[0],s=n[1];return(0,r.useEffect)((function(){y.Z.fetchDistrictDetails(e.params.districtId).then((function(e){s(e)}))}),[]),r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-9"},r.createElement("div",{className:"col-md-12 margin-10-top"},r.createElement(c.Z,null,r.createElement(o.Z,{className:"panel-small"},r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-4"},r.createElement("div",{className:"btn-group",role:"group"},r.createElement(i.Z,{iconName:"glyphicon-arrow-left",onClickAction:l.mW.goBack}))),r.createElement("div",{className:"col-md-4"},r.createElement("h4",{className:"text-center"},"Afspraak plannen ",u.name)),r.createElement("div",{className:"col-md-4"}))))),r.createElement("div",{className:"col-md-12 margin-10-top"},r.createElement(b,{districtId:e.params.districtId,opportunityId:e.params.opportunityId}))),r.createElement("div",{className:"col-md-3"}))}}}]);