"use strict";(self.webpackChunkeco=self.webpackChunkeco||[]).push([[8867],{14050:(e,t,n)=>{n.d(t,{Z:()=>c});var a=n(69265),r="".concat(URL_API,"/api/contact");const c={fetchContactAvailabilitiesByWeek:function(e,t){return a.Z.get("".concat(r,"/").concat(e,"/availability/by-week"),{params:{startOfWeek:t}}).then((function(e){return e.data}))},updateContactAvailabilities:function(e,t){return a.Z.post("".concat(r,"/").concat(e,"/availability"),t)},copyAvailabilities:function(e,t){return a.Z.post("".concat(r,"/").concat(e,"/availability/copy-weeks"),t)},fetchDistrictAvailabilitiesByWeek:function(e){var t=e.districtId,n=e.startOfWeek;return a.Z.get("".concat(URL_API,"/api/district/").concat(t,"/availability/by-week"),{params:{startOfWeek:n}}).then((function(e){return e.data}))}}},97809:(e,t,n)=>{n.d(t,{Z:()=>c});var a=n(69265),r="district";const c={fetchDistricts:function(){return a.Z.get(r).then((function(e){return e.data}))},fetchDistrictDetails:function(e){return a.Z.get("".concat(r,"/").concat(e)).then((function(e){return e.data}))},fetchDistrictCalendarItems:function(e,t,n){return a.Z.get("".concat(r,"/").concat(e,"/calendar-items"),{params:{startDate:t,endDate:n}}).then((function(e){return e.data}))},newDistrict:function(e){return a.Z.post(r,e).then((function(e){return e.data}))},updateDistrict:function(e){return a.Z.post("".concat(r,"/").concat(e.id),e)},deleteDistrict:function(e){return a.Z.post("".concat(r,"/").concat(e.id,"/delete"))},detachDistrictCoach:function(e){var t=e.districtId,n=e.coachId;return a.Z.post("".concat(r,"/").concat(t,"/coaches/").concat(n,"/detach"))},attachDistrictCoach:function(e){var t=e.districtId,n=e.coachId;return a.Z.post("".concat(r,"/").concat(t,"/coaches/").concat(n,"/attach"))}}},18867:(e,t,n)=>{n.r(t),n.d(t,{default:()=>k});var a=n(29439),r=n(67294),c=n(14309),o=n(98688),i=n(55451),u=n(61409),l=n(4942),s=n(80720),m=n(30381),f=n.n(m),d=n(14050),p=n(89038),v=n(41355);function h(e){var t=e.coaches,n=e.onSelectCoach,c=e.onCancel,o=(0,r.useState)(null),i=(0,a.Z)(o,2),u=i[0],l=i[1];return(0,r.useEffect)((function(){l(t[0].id)}),[]),r.createElement(v.Z,{buttonConfirmText:"Plannen",closeModal:c,confirmAction:function(){n(u)},title:"Afspraak plannen"},"Er zijn meerdere coaches beschikbaar, selecteer een coach:",r.createElement("select",{className:"form-control input-sm",value:u,onChange:function(e){return l(e.target.value)}},t.map((function(e){return r.createElement("option",{key:e.id,value:e.id},e.fullName)}))))}function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function b(e){var t=e.district,n=e.opportunityId;if(!t)return null;var l=(0,r.useState)(90),m=(0,a.Z)(l,2),v=m[0],E=m[1],b=(0,r.useState)([]),y=(0,a.Z)(b,2),k=y[0],Z=y[1],N=(0,r.useState)([]),A=(0,a.Z)(N,2),D=A[0],O=A[1],w=(0,r.useState)(""),C=(0,a.Z)(w,2),I=C[0],M=C[1],S=(0,r.useState)(""),x=(0,a.Z)(S,2),P=x[0],j=x[1],W=(0,r.useState)([]),Y=(0,a.Z)(W,2),B=Y[0],R=Y[1],L=(0,r.useState)(null),q=(0,a.Z)(L,2),z=q[0],U=q[1],_=(0,r.useState)(!1),G=(0,a.Z)(_,2),Q=G[0],T=G[1];(0,r.useEffect)((function(){M(f()().startOf("isoWeek").format("YYYY-MM-DD")),E(t.defaultDurationMinutes)}),[]),(0,r.useEffect)((function(){I&&(d.Z.fetchDistrictAvailabilitiesByWeek({districtId:t.id,startOfWeek:I}).then((function(e){R(F(e))})),K())}),[I]);var F=function(e){return e.reduce((function(e,t){return t.availabilities=t.availabilities.map((function(e){return g(g({},e),{},{from:f()(e.from),to:f()(e.to)})})),H(t).forEach((function(n){e.push(g(g({},n),{},{coach:{id:t.id,fullName:t.fullName}}))})),e}),[])},H=function(e){for(var t=e.quotationRequests.map((function(t){return{from:f()(t.datePlanned).subtract(e.coachMinMinutesBetweenAppointments,"minutes"),to:f()(t.datePlanned).add(t.durationMinutes,"minutes").add(e.coachMinMinutesBetweenAppointments,"minutes")}})),n=e.availabilities,a=function(e){var a=t[e];n=n.reduce((function(e,t){return t.from.isSameOrAfter(a.from)&&t.to.isSameOrBefore(a.to)?e:t.from.isBefore(a.from)&&t.to.isAfter(a.to)?(e.push(g(g({},t),{},{from:t.from,to:a.from})),e.push(g(g({},t),{},{from:a.to,to:t.to})),e):t.from.isBefore(a.from)&&t.to.isSameOrAfter(a.from)?(e.push(g(g({},t),{},{from:t.from,to:a.from})),e):t.from.isSameOrBefore(a.to)&&t.to.isAfter(a.to)?(e.push(g(g({},t),{},{from:a.to,to:t.to})),e):(e.push(t),e)}),[])},r=0;r<t.length;r++)a(r);return n};(0,r.useEffect)((function(){J()}),[B,v]);var J=function(){var e=B.reduce((function(e,t){return!e||60*t.from.get("hour")+t.from.get("minute")<e?60*t.from.get("hour")+t.from.get("minute"):e}),null),t=B.reduce((function(e,t){return!e||60*t.to.get("hour")+t.to.get("minute")>e?60*t.to.get("hour")+t.to.get("minute"):e}),null);e&&t||O([]);for(var n=[],a=e=30*Math.floor(e/30);a<=t-v;a+=30)n.push(a);O(n)},K=function(){for(var e=[],t=f()(I),n=t.clone().endOf("isoWeek");t<=n;)e.push(t.clone()),t.add(1,"d");Z(e)},V=function(e){var t=Math.floor(e/60),n=e%60;return(t=t<10?"0"+t:t)+":"+(n<10?"0"+n:n)},X=function(){for(var e=f()().startOf("isoWeek"),t=[],n=0;n<52;n++)t.push({value:e.format("YYYY-MM-DD"),text:"Week "+e.format("W")+" ("+e.format("DD-MM")+")"}),e.add(1,"w");return t},$=function(){var e=X().findIndex((function(e){return e.value===I}));if(e>0)return X()[e-1].value},ee=function(){var e=X().findIndex((function(e){return e.value===I}));if(e<X().length-1)return X()[e+1].value},te=function(e,t){return(P?B.filter((function(e){return e.coach.id===parseInt(P)})):B).filter((function(n){return n.from<=f()(e).add(t,"minutes")&&n.to>=f()(e).add(t+v,"minutes")}))},ne=function(e,a,r){Q||(T(!0),p.Z.newQuotationRequest({organisationOrCoachId:r,opportunityId:n,datePlanned:e.format("YYYY-MM-DD"),timePlanned:V(a),durationMinutes:v,usesPlanning:!0,districtId:t.id,statusId:8,opportunityActionCodeRef:"visit",projectManagerId:null,externalPartyId:null,dateRecorded:"",dateReleased:"",dateApprovedClient:"",dateApprovedProjectManager:"",dateApprovedExternal:""}).then((function(e){u.nA.push("/offerteverzoek/".concat(e.data.id))})),U(null))};return r.createElement(c.Z,null,r.createElement(s.Z,null,r.createElement("div",{className:"row"},r.createElement("div",{className:"col-sm-3"},r.createElement(i.Z,{disabled:!$(),iconName:"arrowLeft",buttonClassName:"btn-default btn-sm",onClickAction:function(){return M($())}})),r.createElement("div",{className:"col-sm-2"},r.createElement("select",{className:"form-control input-sm",value:I,onChange:function(e){return M(e.target.value)}},X().map((function(e){return r.createElement("option",{key:e.value,value:e.value},e.text)})))),r.createElement("div",{className:"col-sm-2"},r.createElement("select",{className:"form-control input-sm",value:P,onChange:function(e){return j(e.target.value)}},r.createElement("option",{value:""},"Alle coaches"),B.reduce((function(e,t){return e.find((function(e){return e.id===t.coach.id}))||e.push(t.coach),e}),[]).map((function(e){return{value:e.id,text:e.fullName}})).map((function(e){return r.createElement("option",{key:e.value,value:e.value},e.text)})))),r.createElement("div",{className:"col-sm-2"},r.createElement("select",{className:"form-control input-sm",value:v,onChange:function(e){return E(parseInt(e.target.value))}},function(){for(var e=[],t=30;t<=180;t+=15)e.push({value:t,text:t+" minuten"});return e}().map((function(e){return r.createElement("option",{key:e.value,value:e.value},e.text)})))),r.createElement("div",{className:"col-sm-3",style:{textAlign:"right"}},r.createElement(i.Z,{disabled:!ee(),iconName:"arrowRight",buttonClassName:"btn-default btn-sm",onClickAction:function(){return M(ee())}})))),r.createElement(o.Z,null,r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-12"},r.createElement("table",{className:"table-drag-select",style:{width:"100%"}},r.createElement("thead",null,r.createElement("tr",null,k.map((function(e,t){return r.createElement("th",{key:t,style:{textAlign:"center"}},e.format("dd DD-MM"))})))),r.createElement("tbody",null,0===D.length?r.createElement("tr",null,r.createElement("td",{colSpan:7,style:{textAlign:"center"}},"Geen beschikbare data gevonden")):D.map((function(e,t){return r.createElement("tr",{key:t},k.map((function(t,n){return te(t,e).length>0?r.createElement("td",{key:n,style:{textAlign:"center",padding:"3px"}},r.createElement("button",{className:"btn btn-sm",style:{width:"100%"},onClick:function(){return function(e,t){var n=te(e,t);1!==n.length?U({day:e,timeslot:t}):ne(e,t,n[0].coach.id)}(t,e)}},V(e)," - ",V(e+v))):r.createElement("td",{key:n,style:{textAlign:"center"}})})))}))))))),null!==z&&r.createElement(h,{coaches:te(z.day,z.timeslot).map((function(e){return e.coach})),onSelectCoach:function(e){return ne(z.day,z.timeslot,e)},onCancel:function(){return U(null)}}))}var y=n(97809);function k(e){var t=(0,r.useState)(!1),n=(0,a.Z)(t,2),l=n[0],s=n[1];return(0,r.useEffect)((function(){y.Z.fetchDistrictDetails(e.params.districtId).then((function(e){s(e)}))}),[]),r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-9"},r.createElement("div",{className:"col-md-12 margin-10-top"},r.createElement(c.Z,null,r.createElement(o.Z,{className:"panel-small"},r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-4"},r.createElement("div",{className:"btn-group",role:"group"},r.createElement(i.Z,{iconName:"arrowLeft",onClickAction:u.mW.goBack}))),r.createElement("div",{className:"col-md-4"},r.createElement("h4",{className:"text-center"},"Afspraak plannen ",l.name)),r.createElement("div",{className:"col-md-4"}))))),r.createElement("div",{className:"col-md-12 margin-10-top"},r.createElement(b,{district:l,opportunityId:e.params.opportunityId}))),r.createElement("div",{className:"col-md-3"}))}}}]);